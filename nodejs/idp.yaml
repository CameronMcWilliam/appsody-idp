apiVersion: codewind.dev/v1alpha1
metadata: 
  name: java-liberty-pack
  language: java
  framework: liberty
  version: 0.0.1 
  maintainers:
  - name: Jonathan West
    email: jgwest@email.com
    githubID: jgwest
spec:
  dev: 
    watched:
      watchDir: /src
      ignoredPaths:
      - /target
      - /some.file
    uploadFilter:
      ignoredPaths:
      - /target
      
  runtime:
    image: node:10-alpine
    endpoints:
      containerHealth: /health
      appRoot: /app
    ports:
      internalHttpPort: 8080
    logs:
    - type: some.type
      path: /logs/(etc)

    kubernetes:
      livenessProbe:
        initialDelaySeconds: 15
        timeoutSeconds: 60
      readinessProbe:
        initialDelaySeconds: 15
        timeoutSeconds: 60
      memoryLimit: 600Mi
      runAsUser: 185 

  shared:
    tasks:
      disposeOfSharedContainersOnTaskComplete: true
      disposeOnScenarioComplete: true
      idleTaskContainerTimeout: 3600 

  tasks:
    - name: npm-install
      buildImage: node-10:alpine
      command: npm install
      workingDirectory: /projects
      logs:
      - type: npm.install
        path: /logs
      
    - name: server-start
      buildImage: node-10:alpine
      command: npm start

  scenarios:
    - name: full-build
      tasks: ["npm-install", "server-start"]
